# ACM (Anatomically-constrained model)
A framework for for videography based pose tracking of rodents.
By Arne Monsees.

## Installation

1. [Install Anaconda](https://docs.anaconda.com/anaconda/install/)
2. Clone https://github.com/bbo-lab/ACM.git 
3. Start Anaconda Prompt (Windows) / terminal (linux) and navigate into repository directory.
4. Create conda environment `conda env create -f environment.yml` (`-f https://raw.githubusercontent.com/bbo-lab/ACM/main/environment.yml` once repo is public)
6. Install using `pip install .`

## Testing

1. Download [example dataset](https://www.dropbox.com/sh/040587pwx5t7uh3/AAAI5MVilFrJY-mEPr97uADNa?dl=0).
2. Activate conda environment `conda activate bbo_acm`.
3. View 2d labels by running `python -m ACM --viewer [Path of "table_1_20210511" folder from step 1.]`
4. Run `python -m ACM [Path of "table_1_20210511" folder from step 1.]` (expected to take around 20 mins on modern 8-core CPU - preliminary number from notebook with an AMD Ryzen 7 PRO 5850U, using the iGPU, so probaably notably faster on GPU workstation).
5. View 3d tracked pose by running `python -m ACM --viewer [Path of "table_1_20210511" folder from step 1.]`

## Setting up your own dataset config

### Overview

#### Input

A dataset input config consists of a folder with the following files:

- `configuration.py`: Configuration file that determines settings and input and out paths
- `model.npz`: ...
- `multicalibration.npy`: ...
- `origin_coord.npy`: Coordinate system of the final result, relative to the coordinate system of the camera calibration
- `labels_manual.npz`: Manual labels on the videography data
- `labels_dlc_n_m.npy`: Automatically detected labels on the videography data

#### Output

A dataset output consists of a folder with the following files:

- `pose.npy`: ...
- `save_dict.npy`: ...

Further, the following intermediate files are generated by calibration and initialization:

- `x_calib.npy`: ...
- `x_ini.npy`: ...

By default, results are saved into the `results` subfolder of the datset configuration.

### File structure of input and output files

The structure of the inputs is documented in [INPUTS.md](https://github.com/bbo-lab/ACM/blob/main/INPUTS.md). The structure of the outputs is documented in [OUTPUTS.md](https://github.com/bbo-lab/ACM/blob/main/OUTPUTS.md)

